---
date: 2025-08-22
user: Roel4990
topic: CPU 파이프라인의 함정 데이터 해저드와 해결 전략
---

# CPU 파이프라인의 함정: 데이터 해저드와 해결 전략

CPU 파이프라인은 명령어 처리 속도를 높이기 위해 여러 명령어를 동시에 여러 단계에 걸쳐 처리하는 기술입니다. 하지만 이 과정에서 파이프라인 해저드(Pipeline Hazard)라는 문제가 발생할 수 있는데, 이는 다음 명령어의 실행을 방해하여 파이프라인의 효율을 떨어뜨리는 현상입니다.

## 1. 파이프라인 해저드란?

파이프라인 해저드는 명령어들이 파이프라인을 따라 흐르면서 충돌하거나 대기하게 만드는 상황을 의미합니다. 크게 세 가지 유형이 있습니다.

### 1.1 구조적 해저드 (Structural Hazard)
두 개 이상의 명령어가 동시에 동일한 하드웨어 자원을 사용하려고 할 때 발생합니다. 예를 들어, 한 명령어는 메모리에서 데이터를 읽고 있는데, 다른 명령어는 같은 메모리 포트에 데이터를 쓰려고 하는 경우입니다.

### 1.2 제어 해저드 (Control Hazard): 분기(Branch) 명령어 때문에 발생합니다.
분기(Branch) 명령어 때문에 발생합니다. 분기 명령어의 조건이 참인지 거짓인지 확정되기 전에, CPU가 다음 명령어를 예측하여 파이프라인에 넣는데, 예측이 틀릴 경우 파이프라인의 모든 명령어들을 버리고 다시 시작해야 합니다.

### 1.3 데이터 해저드 (Data Hazard)
한 명령어의 실행 결과가 다음 명령어의 입력값으로 사용될 때 발생합니다. 아직 이전 명령어의 결과가 나오지 않았는데 다음 명령어가 그 결과를 사용하려 할 때 파이프라인이 멈추게 됩니다. 데이터 해저드는 파이프라인에서 가장 빈번하게 발생하는 문제 중 하나입니다.

---

### 2. 데이터 해저드 예시

데이터 해저드는 파이프라인에서 가장 빈번하게 발생하는 문제 중 하나입니다. 다음 두 명령어가 연속적으로 실행되는 상황을 가정해 봅시다.

```assembly
ADD R1, R2, R3  // R1 레지스터에 R2 + R3의 결과 저장
SUB R4, R1, R5  // R1의 값을 사용하여 R4 = R1 - R5 연산
```

- ADD 명령어는 R2 + R3 연산을 수행하고, 그 결과를 최종적으로 R1 레지스터에 기록합니다.

- SUB 명령어는 ADD의 결과인 R1 레지스터의 값을 읽어와 연산을 시작해야 합니다.

문제는 ADD 명령어가 R1에 최종 값을 쓰는 시점(Write-back 단계)이 SUB 명령어가 R1의 값을 읽는 시점(Instruction Decode 단계)보다 늦다는 것입니다. 이로 인해 SUB는 R1의 올바른 값을 얻지 못해 파이프라인이 멈추는 스톨(Stall) 현상이 발생합니다.

---
## 3. 데이터 해저드 해결 방법

데이터 해저드를 해결하는 가장 효과적인 방법은 파이프라인을 멈추지 않고 데이터를 바로 전달하는 것입니다.

### 3.1 포워딩(Forwarding) 또는 바이패싱(Bypassing)
포워딩은 한 명령어의 연산 결과를 레지스터에 기록하기 전에, 그 결과를 필요로 하는 다음 명령어의 입력 단계로 직접 전달하는 기술입니다.

예시: 위 ADD와 SUB 명령어의 경우, ADD 명령어가 연산(Execute) 단계에서 결과를 계산하면, 그 결과값을 SUB 명령어의 입력 단계(Instruction Decode)로 바로 전달해줍니다. 이렇게 되면 SUB는 ADD가 R1에 값을 쓸 때까지 기다릴 필요 없이 즉시 계산을 시작할 수 있습니다. 마치 생산 라인에서 부품이 완성되자마자 다음 공정으로 바로 전달되어 대기 시간을 없애는 것과 같습니다.


### 3.2 파이프라인 스톨(Stall)
포워딩이 불가능한 경우, 파이프라인에 빈 명령어(NOP)를 삽입하여 다음 명령어를 강제로 지연시킵니다. 이는 마치 고속도로에서 앞차가 끼어들 공간을 확보하기 위해 잠깐 속도를 늦추는 것과 같습니다. 스톨은 성능 손실이 발생하지만, 데이터 의존성 문제를 확실하게 해결합니다.


### 3.3 명령어 재배치(Instruction Reordering)
컴파일러나 CPU는 명령어들의 의존성을 분석하여 순서를 재배치할 수 있습니다. 예를 들어, A와 B라는 두 명령어가 서로 의존성이 없는 경우, 이 둘을 순서를 바꿔 실행하여 데이터 해저드를 회피할 수 있습니다.

---

### 4. 결론
현대 CPU는 파이프라인의 효율을 극대화하기 위해 해저드를 해결하는 다양한 기술을 사용합니다. 특히, 포워딩은 파이프라인의 병목 현상을 해결하는 가장 중요한 기술 중 하나입니다. 이러한 기술들은 단순히 명령어 처리 속도를 높이는 것을 넘어, 복잡한 프로그램을 안정적이고 빠르게 실행할 수 있는 기반이 됩니다.